format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

project_type: flutter

workflows:
  primary:
    steps:
    - activate-ssh-key@4:
        run_if: '{{setup_ssh_key}}'
    - git-clone@6: {}
    - script@1:
        title: "Check and Set environment"
        inputs:
        - content: |-
            #!/bin/bash
            set -ex
            env | sort
            # Forzar Java 17
            jenv global 17 || true
            export JAVA_HOME=$JAVA_HOME_17_X64
            export PATH=$JAVA_HOME/bin:$PATH
            java -version
    - flutter-installer@0:
        inputs:
        - is_update: "false"
    - script@1:
        title: "Fix for filePermissions error"
        inputs:
        - content: |-
            #!/bin/bash
            set -ex
            # Limpiar y forzar dependencias
            flutter clean
            flutter pub get
            
            # Aceptar licencias manualmente
            yes | sdkmanager --licenses || true
            
            # Forzar permisos de ejecuci√≥n en el wrapper de gradle
            chmod +x android/gradlew
    - flutter-build@0:
        inputs:
        - project_location: "."
        - platform: android
        - build_mode: debug
    - deploy-to-bitrise-io@2: {}

app:
  envs:
  - opts:
      is_expand: false
    BITRISE_FLUTTER_PROJECT_LOCATION: "."
